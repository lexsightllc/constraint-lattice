#!/usr/bin/env bash
set -euo pipefail

SCRIPT_DIR=$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)
source "$SCRIPT_DIR/lib.sh"

OUTPUT_DIR=${OUTPUT_DIR:-$REPO_ROOT/docs/api}
mkdir -p "$OUTPUT_DIR"

with_venv
ensure_command pdoc

log INFO "Generating API documentation into $OUTPUT_DIR"
pdoc --html --output-dir "$OUTPUT_DIR" src

if [ -d "$REPO_ROOT/dashboard" ]; then
  ensure_command npm
  if grep -q '"docs:build"' "$REPO_ROOT/dashboard/package.json"; then
    log INFO "Building dashboard documentation bundle"
    (cd "$REPO_ROOT/dashboard" && npm run docs:build)
  else
    log INFO "No docs:build script defined in dashboard/package.json; skipping frontend docs"
  fi
fi

log INFO "Documentation build complete"
